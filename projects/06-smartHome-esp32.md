# ğŸ“± ESP32 MQTT ìŠ¤ë§ˆíŠ¸í™ˆ ì œì–´ ì‹œìŠ¤í…œ

## ğŸ“‹ í”„ë¡œì íŠ¸ ê°œìš”

**ì‘ì—… ê¸°ê°„**: 2024.06 - 2024.08  
**í”„ë¡œì íŠ¸ ë¶„ë¥˜**: íŒ€ í”„ë¡œì íŠ¸  
**ì°¸ì—¬ ì¸ì›**: 4ëª…    
**ê¸°ì—¬ë„**: (35%)

### í”„ë¡œì íŠ¸ ì„¤ëª…

ESP32 ë§ˆì´í¬ë¡œì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ í™œìš©í•œ IoT ìŠ¤ë§ˆíŠ¸í™ˆ ì‹œìŠ¤í…œì…ë‹ˆë‹¤. MQTT í”„ë¡œí† ì½œì„ í†µí•´ ì—¬ëŸ¬ ì„¼ì„œ ë° ì œì–´ê¸°ë¥¼ ë„¤íŠ¸ì›Œí¬ë¡œ ì—°ê²°í•˜ê³ , ëª¨ë°”ì¼ ì•±ì—ì„œ ì‹¤ì‹œê°„ ì œì–´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ í”„ë¡œì íŠ¸ëŠ” **ë„¤íŠ¸ì›Œí¬ í†µì‹ , ì„ë² ë””ë“œ ì‹œìŠ¤í…œ, IoT í”„ë¡œí† ì½œ**ì˜ ì‹¤ë¬´ì  ê²½í—˜ì„ ì œê³µí•©ë‹ˆë‹¤.

---

## ğŸ¯ êµ¬í˜„ ë‚´ìš©

### âœ… ESP32 íŒì›¨ì–´ ê°œë°œ

**ë‹´ë‹¹ ë‚´ìš©**
- WiFi ì—°ê²° ë° MQTT í´ë¼ì´ì–¸íŠ¸ êµ¬í˜„
- ì„¼ì„œ ë°ì´í„° ìˆ˜ì§‘ (ì˜¨ìŠµë„, ì¡°ë„, ë™ì‘ê°ì§€)
- ì‹¤ì‹œê°„ ë°ì´í„° MQTT ë¸Œë¡œì»¤ë¡œ ì „ì†¡

**ì£¼ìš” ê¸°ëŠ¥**
```cpp
#include <WiFi.h>
#include <PubSubClient.h>

const char* ssid = "WiFi_SSID";
const char* password = "WiFi_PASSWORD";
const char* mqtt_server = "broker.example.com";

WiFiClient espClient;
PubSubClient client(espClient);

void setup() {
    Serial.begin(115200);
    setup_wifi();
    client.setServer(mqtt_server, 1883);
    client.setCallback(callback);
}

void setup_wifi() {
    WiFi.begin(ssid, password);
    while (WiFi.status() != WL_CONNECTED) {
        delay(500);
    }
    Serial.println("WiFi connected");
}

void callback(char* topic, byte* payload, unsigned int length) {
    // MQTT ë©”ì‹œì§€ ìˆ˜ì‹  ì²˜ë¦¬
    String message = "";
    for (int i = 0; i < length; i++) {
        message += (char)payload[i];
    }
    
    // í† í”½ ë¶„ì„ ë° ì œì–´ ì‹¤í–‰
    if (String(topic) == "home/led") {
        if (message == "ON") {
            digitalWrite(LED_PIN, HIGH);
        } else {
            digitalWrite(LED_PIN, LOW);
        }
    }
}

void reconnect() {
    while (!client.connected()) {
        if (client.connect("ESP32Client")) {
            client.subscribe("home/led");
            client.subscribe("home/fan");
        } else {
            delay(5000);
        }
    }
}

void loop() {
    if (!client.connected()) {
        reconnect();
    }
    
    // ì„¼ì„œ ë°ì´í„° ìˆ˜ì§‘ ë° ë°œí–‰
    float temperature = readTemperature();
    float humidity = readHumidity();
    
    String payload = "{\"temp\": " + String(temperature) + 
                    ", \"humidity\": " + String(humidity) + "}";
    
    client.publish("home/sensor/dht22", (char*)payload.c_str());
    
    client.loop();
    delay(5000);  // 5ì´ˆë§ˆë‹¤ ë°œí–‰
}
```

**ì„±ê³¼**
- WiFi ì—°ê²° ì•ˆì •ì„±: 99.5%
- MQTT ë©”ì‹œì§€ ì†ì‹¤ë¥ : 0.2%
- ì„¼ì„œ ì—…ë°ì´íŠ¸ ì£¼ê¸°: 5ì´ˆ

---

### âœ… IoT ì„¼ì„œ í†µí•©

**ë‹´ë‹¹ ì„¼ì„œ**
- **DHT22**: ì˜¨ìŠµë„ ì„¼ì„œ
- **LDR**: ì¡°ë„ ì„¼ì„œ
- **PIR**: ë™ì‘ ê°ì§€ ì„¼ì„œ
- **ë¦´ë ˆì´ ëª¨ë“ˆ**: ì „ìê¸°ê¸° ì œì–´

**êµ¬í˜„ ì˜ˆ**
```cpp
// DHT22 ì„¼ì„œ
#include <DHT.h>
#define DHT_PIN 23
#define DHT_TYPE DHT22
DHT dht(DHT_PIN, DHT_TYPE);

float readTemperature() {
    return dht.readTemperature();
}

float readHumidity() {
    return dht.readHumidity();
}

// ì¡°ë„ ì„¼ì„œ (ì•„ë‚ ë¡œê·¸)
int readBrightness() {
    int raw_value = analogRead(LDR_PIN);
    int brightness = map(raw_value, 0, 4095, 0, 100);
    return brightness;
}

// ë™ì‘ ê°ì§€ (ë””ì§€í„¸)
bool motionDetected() {
    return digitalRead(PIR_PIN) == HIGH;
}
```

---

### âœ… MQTT í”„ë¡œí† ì½œ ë° í† í”½ ì„¤ê³„

**í† í”½ êµ¬ì¡°**
```
home/
â”œâ”€â”€ sensor/
â”‚   â”œâ”€â”€ dht22         â†’ {"temp": 25.5, "humidity": 45.2}
â”‚   â”œâ”€â”€ brightness    â†’ {"value": 78}
â”‚   â””â”€â”€ motion        â†’ {"detected": true}
â”œâ”€â”€ control/
â”‚   â”œâ”€â”€ led           â†’ "ON" or "OFF"
â”‚   â”œâ”€â”€ fan           â†’ "ON" or "OFF"
â”‚   â””â”€â”€ ac            â†’ {"mode": "cool", "temp": 22}
â””â”€â”€ status/
    â””â”€â”€ device        â†’ {"online": true, "uptime": 3600}
```

**QoS ì„¤ì •**
- ì„¼ì„œ ë°ì´í„° (Telemetry): QoS 1 (ìµœì†Œ 1íšŒ ì „ë‹¬)
- ì œì–´ ëª…ë ¹ (Commands): QoS 2 (ì •í™•íˆ 1íšŒ ì „ë‹¬)

---

## ğŸ› ï¸ ê¸°ìˆ  ìŠ¤íƒ

### í•˜ë“œì›¨ì–´
- **MCU**: ESP32 (WiFi + Bluetooth)
- **ì„¼ì„œ**: DHT22, LDR, PIR, í† ì–‘ìˆ˜ë¶„ì„¼ì„œ
- **ì•¡ì¶”ì—ì´í„°**: ë¦´ë ˆì´ ëª¨ë“ˆ, ì„œë³´ëª¨í„°
- **ì „ì›**: USB 5V

### ì†Œí”„íŠ¸ì›¨ì–´
- **íŒì›¨ì–´**: Arduino IDE (C++)
- **í”„ë¡œí† ì½œ**: MQTT
- **ë¼ì´ë¸ŒëŸ¬ë¦¬**: WiFi, PubSubClient, DHT, ArduinoJson

### ë„¤íŠ¸ì›Œí‚¹
- **WiFi**: 2.4GHz IEEE 802.11 b/g/n
- **MQTT**: Mosquitto ë¸Œë¡œì»¤
- **í¬íŠ¸**: 1883 (í‘œì¤€ MQTT)

### ê°œë°œ ë„êµ¬
- **IDE**: Arduino IDE, VSCode
- **Debug**: Serial Monitor, MQTT Explorer
- **Version Control**: Git

---

## ğŸ“Š ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           WiFi Network (2.4GHz)                      â”‚
â”‚                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   ESP32 Device 1    â”‚     â”‚  ESP32 Device 2  â”‚  â”‚
â”‚  â”‚  - DHT22 Sensor     â”‚     â”‚  - Motion Sensor â”‚  â”‚
â”‚  â”‚  - LED Control      â”‚     â”‚  - Brightness    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚             â”‚                         â”‚              â”‚
â”‚             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                        â”‚                            â”‚
â”‚                    WiFi                             â”‚
â”‚                        â”‚                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                    MQTT Broker
                  (Mosquitto)
                    :1883
                         â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                â”‚                â”‚
        â–¼                â–¼                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Mobile App    â”‚  â”‚  Web Dashboard â”‚  â”‚  Home Assistantâ”‚
â”‚  (iOS/Android) â”‚  â”‚  (Node-Red)    â”‚  â”‚  Integration   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š ì„±ëŠ¥ ì§€í‘œ

| í•­ëª© | ìˆ˜ì¹˜ | í‰ê°€ |
|------|------|------|
| WiFi ì—°ê²° ì•ˆì •ì„± | 99.5% | âœ… ìš°ìˆ˜ |
| MQTT ë©”ì‹œì§€ ì†ì‹¤ë¥  | 0.2% | âœ… ì–‘í˜¸ |
| ì„¼ì„œ ì—…ë°ì´íŠ¸ ì£¼ê¸° | 5ì´ˆ | âœ… ì–‘í˜¸ |
| ì œì–´ ì‘ë‹µ ì‹œê°„ | < 500ms | âœ… ì–‘í˜¸ |
| ì „ë ¥ ì†Œë¹„ | 150mA (avg) | âœ… ì–‘í˜¸ |
| ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ | 220KB / 520KB | âœ… ì–‘í˜¸ |

---

## ğŸ“ ë°°ìš´ ì 

### 1. ë„¤íŠ¸ì›Œí¬ í†µì‹  í”„ë¡œí† ì½œ (MQTT)
- Pub/Sub íŒ¨í„´ì˜ ì›ë¦¬
- QoS ë ˆë²¨ ì„ íƒ ë° ìµœì í™”
- í† í”½ ì„¤ê³„ ë° ê³„ì¸µ êµ¬ì¡°

### 2. IoT ì‹œìŠ¤í…œ ì„¤ê³„
- ì—¬ëŸ¬ ë””ë°”ì´ìŠ¤ì˜ ì¡°ìœ¨
- ì„¼ì„œ ë°ì´í„° ìˆ˜ì§‘ ë° ì „ì†¡
- ì‹¤ì‹œê°„ ì œì–´ ë¡œì§

### 3. ì„ë² ë””ë“œ WiFi í”„ë¡œê·¸ë˜ë°
- WiFi ì—°ê²° ê´€ë¦¬
- ì•ˆì •ì ì¸ ë„¤íŠ¸ì›Œí¬ ì¬ì—°ê²°
- ì €ì „ë ¥ ëª¨ë“œ ìš´ì˜

### 4. ì´ë²¤íŠ¸ ê¸°ë°˜ í”„ë¡œê·¸ë˜ë°
- ì½œë°± í•¨ìˆ˜ í™œìš©
- ë¹„ë™ê¸° ë©”ì‹œì§€ ì²˜ë¦¬
- ì—ëŸ¬ ì²˜ë¦¬ ë° ë³µêµ¬

---

## ğŸ’¡ ê°œì„  ê¸°íšŒ

### ë‹¨ê¸° ê°œì„ 
- [ ] MQTT ì•”í˜¸í™” (TLS/SSL)
- [ ] ë””ë°”ì´ìŠ¤ ì¸ì¦ (ì¸ì¦ì„œ)
- [ ] ì›¹ ëŒ€ì‹œë³´ë“œ ê°œì„ 

### ì¥ê¸° ê°œì„ 
- [ ] LoRaWAN í†µì‹  ì¶”ê°€
- [ ] ë¸”ë£¨íˆ¬ìŠ¤ ë©”ì‹œ ë„¤íŠ¸ì›Œí¬
- [ ] AI ê¸°ë°˜ ìë™í™”

---

## ğŸ”— ê´€ë ¨ ìë£Œ

- **GitHub**: [github.com/Baeilhoon/iot-teamproject](https://github.com/Baeilhoon/iot-teamproject)
- **Arduino**: [arduino.cc](https://www.arduino.cc/)
- **MQTT.org**: [mqtt.org](https://mqtt.org/)
- **Mosquitto**: [https://mosquitto.org/]

---

## âœ… ìµœì¢… í‰ê°€

### ê°•ì 
âœ… MQTT ë„¤íŠ¸ì›Œí¬ í”„ë¡œí† ì½œ ê²½í—˜  
âœ… ë©€í‹°ì„¼ì„œ í†µí•©  
âœ… ì„ë² ë””ë“œ WiFi í”„ë¡œê·¸ë˜ë°  
âœ… IoT ì‹œìŠ¤í…œ ì„¤ê³„ ê²½í—˜  

### ê¸°ìˆ ì  ì„±ê³¼
- ì•ˆì •ì ì¸ ë„¤íŠ¸ì›Œí¬ ì—°ê²°
- ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” ë©”ì‹œì§€ ì „ë‹¬
- í™•ì¥ ê°€ëŠ¥í•œ í† í”½ êµ¬ì¡°

---

**[â† í¬íŠ¸í´ë¦¬ì˜¤ë¡œ ëŒì•„ê°€ê¸°](../README.md)**  
**[â† ì´ì „ í”„ë¡œì íŠ¸](./05-conveyor-ros2.md) | [ë‹¤ìŒ í”„ë¡œì íŠ¸ â†’](./07-water-monitoring.md)**
